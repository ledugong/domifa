---
include:
  - project: SocialGouv/gitlab-ci-yml
    file: /base_register_stage.yml
    ref: v7.1.0
  - /packages/backend/.gitlab-ci.yml
  - /packages/frontend/.gitlab-ci.yml
  - https://raw.githubusercontent.com/SocialGouv/code-du-travail-numerique/douglasduteil/refacto-gitlab-separate-package-installation/.gitlab-ci/extends.yml

  #- /.gitlab-ci/variables.yml
  #- /.gitlab-ci/extends.yml
  #
  #- /.gitlab-ci/stages/prepare.yml
  #- /.gitlab-ci/stages/quality.yml
  #- /.gitlab-ci/stages/register.yml
  #- /.gitlab-ci/stages/notify.yml
  # /.gitlab-ci/stages/deploy.yml

#

stages:
  - "Prepare"
  - "Code Quality"
  - "Registration"
  - "Integration test"
  - "Deploy"
  #- "Notify Finished Deployment"
#

.base_stage:
  except:
    variables:
      # Don't run when tagging a commit
      - $RELEASE
      # Don't run when deploying in production an existing image
      - $PRODUCTION
      # Don't run when running e2e tests
      - $E2E_TEST

.prepare_stage:
  extends: .base_stage
  stage: "Prepare"
  dependencies: []

.quality_stage:
  extends: .base_stage
  stage: "Code Quality"
  dependencies: []

.register_stage:
  extends: .base_stage
  stage: "Registration"
  dependencies: []
